<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>GOGCC - 달력</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #333; }
        .calendar { width: 100%; max-width: 700px; border-collapse: collapse; margin: 20px auto; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); table-layout: fixed; }
        .calendar th, .calendar td { border: 1px solid #ddd; padding: 8px; text-align: center; vertical-align: top; }
        .calendar th { background-color: #4CAF50; color: white; width: 100%; }
        .calendar td { width: 100%; min-height: 100px; height: auto; box-sizing: border-box; }
        .calendar td > div { font-size: 12px; word-wrap: break-word; overflow-wrap: break-word; white-space: normal; }
        .holiday { background-color: #ffe6e6; } /* 공휴일, 일요일 */
        .saturday { background-color: #e0f7fa; } /* 토요일 */
        .today { background-color: #e6ffe6; } /* 오늘 */
        .controls { margin: 10px 0; }
        .controls select, .controls button { padding: 8px; margin: 0 5px; border-radius: 3px; border: 1px solid #ddd; }
        .controls button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .controls button:hover { background-color: #45a049; }
        .event-list { text-align: left; max-width: 400px; margin: 20px auto; padding: 15px; background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        a { text-decoration: none; color: #4CAF50; }
        a:hover { color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GOGCC - 달력</h1>
        <a href="manage.html">일정 및 공휴일 관리</a>
        <div class="controls">
            <select id="year"></select> 년
            <button onclick="changeMonth(-1)">◄</button>
            <select id="month"></select> 월
            <button onclick="changeMonth(1)">►</button>
        </div>
        <table class="calendar" id="calendar">
            <thead>
                <tr>
                    <th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="event-list" id="eventList">
            <h3>일정 목록</h3>
        </div>
    </div>

    <script>
        let events = JSON.parse(localStorage.getItem('events')) || {};
        let holidays = JSON.parse(localStorage.getItem('holidays')) || {};
        let currentYear = 2025;
        let currentMonth = 5; // 1~12

        function populateSelectors() {
            const yearSelect = document.getElementById('year');
            const monthSelect = document.getElementById('month');
            yearSelect.innerHTML = '';
            monthSelect.innerHTML = '';
            for (let y = 2020; y <= 2030; y++) {
                yearSelect.innerHTML += `<option value="${y}" ${y === currentYear ? 'selected' : ''}>${y}</option>`;
            }
            for (let m = 1; m <= 12; m++) {
                monthSelect.innerHTML += `<option value="${m}" ${m === currentMonth ? 'selected' : ''}>${m}</option>`;
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
                if (currentYear < 2020) currentYear = 2020;
            } else if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
                if (currentYear > 2030) currentYear = 2030;
            }
            populateSelectors();
            generateCalendar();
        }

        function generateCalendar() {
            const tbody = document.querySelector('#calendar tbody');
            tbody.innerHTML = '';
            const firstDay = new Date(currentYear, currentMonth - 1, 1);
            const lastDay = new Date(currentYear, currentMonth, 0);
            let date = 1;
            let row = document.createElement('tr');

            // 첫 주 빈칸
            for (let i = 0; i < firstDay.getDay(); i++) {
                row.innerHTML += '<td></td>';
            }

            // 날짜 채우기
            while (date <= lastDay.getDate()) {
                if (row.children.length === 7) {
                    tbody.appendChild(row);
                    row = document.createElement('tr');
                }
                const currentDate = new Date(currentYear, currentMonth - 1, date);
                const dateStr = currentDate.toISOString().split('T')[0];
                let className = '';
                let displayText = `<div>${date}`;
                if (dateStr in holidays) {
                    className += 'holiday';
                    displayText += `<br>(${holidays[dateStr]})`;
                } else if (currentDate.getDay() === 6) {
                    className += 'saturday';
                } else if (currentDate.getDay() === 0) {
                    className += 'holiday';
                }
                const today = new Date();
                if (date === today.getDate() && currentMonth === today.getMonth() + 1 && currentYear === today.getFullYear()) {
                    className += (className ? ' ' : '') + 'today';
                }
                displayText += `</div>${getEventsForDate(dateStr)}`;
                row.innerHTML += `<td class="${className}">${displayText}</td>`;
                date++;
            }

            // 마지막 주 빈칸
            while (row.children.length < 7) {
                row.innerHTML += '<td></td>';
            }
            tbody.appendChild(row);

            // 일정 목록
            const eventList = document.getElementById('eventList');
            let eventHtml = '<h3>일정 목록</h3>';
            const monthEvents = [];
            for (let schedule in events) {
                events[schedule].forEach(event => {
                    if (event.date.startsWith(`${currentYear}-${currentMonth.toString().padStart(2, '0')}`)) {
                        let displayText = event.date;
                        if (event.date in holidays) {
                            displayText += ` (${holidays[event.date]})`;
                        }
                        monthEvents.push({ date: event.date, title: `${displayText}: ${schedule}: ${event.title}` });
                    }
                });
            }
            monthEvents.sort((a, b) => a.date.localeCompare(b.date));
            monthEvents.forEach(event => {
                eventHtml += `<div>${event.title}</div>`;
            });
            eventList.innerHTML = eventHtml;
        }

        function getEventsForDate(dateStr) {
            let eventStr = '';
            for (let schedule in events) {
                events[schedule].forEach(event => {
                    if (event.date === dateStr) {
                        eventStr += `<div>${schedule}: ${event.title}</div>`;
                    }
                });
            }
            return eventStr;
        }

        // 이벤트 리스너
        document.getElementById('year').addEventListener('change', function() {
            currentYear = parseInt(this.value);
            generateCalendar();
        });
        document.getElementById('month').addEventListener('change', function() {
            currentMonth = parseInt(this.value);
            generateCalendar();
        });

        // 초기 설정
        populateSelectors();
        generateCalendar();
    </script>
</body>
</html>
